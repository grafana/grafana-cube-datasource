# Cursor Rules for Grafana Cube Datasource

## Dependency Management

**All dependencies must be pinned (exact versions without caret ^ or tilde ~).**

- Always use exact versions like `"16.3.0"` instead of `"^16.3.0"` or `"~16.3.0"`
- This is required for Renovate compatibility and ensures deterministic builds
- When updating dependencies, remove any version range operators (^, ~) and use exact versions
- Check `package.json` to ensure all dependencies follow this pattern

## Git Operations

**In "run everything" Agent mode, avoid interactive commands that require human input.**

- Never use `git rebase -i` (interactive rebase) - it blocks execution waiting for UI input
- Use non-interactive alternatives:
  - `git rebase --onto` to skip specific commits
  - `git reset` + `cherry-pick` to rebuild branches
  - `GIT_SEQUENCE_EDITOR` environment variable for automated rebase editing
- Prefer non-interactive flags and automated approaches

## Commit Strategy

**Prefer atomic commits over amending.**

- Create separate commits for each logical change (e.g., add test, fix bug, refactor)
- Only amend or fixup when explicitly asked by the user
- After completing a commit, new work should go in a new commit
- This preserves the progression of work and makes code review easier

## Examples

✅ **Correct dependency versions:**
```json
"@testing-library/react": "16.3.0"
"react": "18.3.1"
```

❌ **Incorrect dependency versions:**
```json
"@testing-library/react": "^16.3.0"
"react": "~18.3.1"
```

✅ **Correct git operations:**
```bash
git rebase --onto base-branch unwanted-commit~1 current-branch
git reset --hard base-branch && git cherry-pick commit1 commit2
```

❌ **Incorrect git operations:**
```bash
git rebase -i base-branch  # Blocks waiting for human input
```

## GitHub CLI

**When updating GitHub PR descriptions, use the REST API instead of `gh pr edit`.**

- The GraphQL-based `gh pr edit` command fails with "Projects (classic) is being deprecated" errors on some repositories
- Use the REST API directly for reliable PR updates

✅ **Correct:**
```bash
gh api repos/OWNER/REPO/pulls/NUMBER -X PATCH -f body='...'
```

❌ **Incorrect:**
```bash
gh pr edit NUMBER --body '...'
```

## Playwright Testing

**Use non-interactive reporter when running Playwright tests.**

- The default reporter serves an interactive HTML report that blocks with "Press Ctrl+C to quit"
- Use `--reporter=list` for clean, non-interactive output
- This is especially important in "Run Everything" Agent mode

✅ **Correct:**
```bash
npx playwright test --reporter=list
```

❌ **Incorrect:**
```bash
npx playwright test  # Blocks waiting for human input
```

## Testing

**Write minimal tests that are just sufficient to verify behaviour.**

- Use the least amount of test data required to reproduce or illustrate the issue
- Prefer fewer assertions that directly verify the expected behaviour
- Avoid verbose setup when a simpler configuration would suffice
